<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>reveal.js – The HTML Presentation Framework</title>

		<meta name="description" content="A framework for easily creating beautiful presentations using HTML">
		<meta name="author" content="Hakim El Hattab">

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css" id="theme">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>第二章 比特币原理</h1>
                </section>
                
                <section data-markdown>
                    ## 交易，区块，挖矿和区块链
                    - 比特币系统与传统的银行和支付系统不同，是基于去中心化的信任。
                    - 在本章中，我们将通过较高层面跟踪比特币系统单笔交易，观察交易如何通过比特币分布式共识机制变得可信，被接受，并且最终记录在区块链，也就是所有交易的分布式账本。
                </section>

                <section data-markdown>
                    ## 比特币概述
                    - 用户：用户通过密钥控制钱包
                    - 交易：每一笔交易都会被广播到整个比特币网络
                    - 矿工：通过竞争计算生成在每个节点达成共识的区块链，区块链是一个分布式的公共权威账本，包含了比特币网络发生的所有交易。
                </section>

                <section data-markdown>
                    ## 区块链数据查询网站
                    - [Bitcoin Block Explorer](https://blockexplorer.com/)
                    - [BlockCypher Explorer](https://live.blockcypher.com/)
                    - [blockchain.info](https://www.blockchain.com/explorer)
                    - [BitPay Insight](https://insight.bitpay.com/)
                </section>

                <section data-markdown>
                    ## 区块链数据查询网站
                    - 以上每一个查询网站都有搜索功能，可以通过地址，交易哈希值或区块号，搜索到在比特币网络和区块链中对应的数据。
                </section>

                <section data-markdown>
                    ## 支付请求二维码
                    - [支付请求二维码](./images/qrcode.png)
                    - 尝试用你的钱包扫描这个，看看地址和金额，但不要发送货币。
                    - [交易链接](https://blockexplorer.com/tx/0627052b6f28912f2703066a912ea577f2ce4da4caa5a5fbd8a57286c345c2f2)
                    - 从千分之一比特币(1毫比特币）到一亿分之一比特币（1聪比特币），比特币网络可以处理任意小额交易。
                </section>

                <section data-markdown>
                    ## 比特币交易
                    - 交易告知全网: 比特币的持有者已授权把比特币转帐给其他人。
                    - 新持有者能够再次授权，转移给该比特币所有权链中的其他人，产生另一笔交易来花掉这些比特币，
                </section>

                <section data-markdown>
                    ## 交易的输入与输出
                    - 交易就像复式记账法账簿中的行。
                    - 每一笔交易包含一个或多个“输入”。输入的所有权证明，以所有者的数字签名形式存在，并可以被任何人独立验证。
                    - 有一个或多个“输出”。
                    - 输入和输出的总额不需要相等。
                    - 当输出累加略少于输入量，两者的差额就代表了一笔隐含的“矿工费”。
                    - 矿工费也是将交易放进账簿的矿工所收集到的一笔小额支付。
                    - [示意图](./images/transaction.png)
                </section>

                <section data-markdown>
                    ## 交易链
                    - [示意图](./images/transaction1.png)
                    - 交易链中，一笔交易输出就是另一笔交易的输入
                    - Alice的密钥提供了解锁之前交易输出的签名，因此向比特币网络证明她拥有这笔钱。
                    - 她将买咖啡的这笔支付附加到Bob的地址上，明确指明要求是Bob签名才能消费这笔钱。
                </section>

                <section data-markdown>
                    ## 找零
                    - 如果购买了一个价格为5比特币但只能使用20比特币输入的商品，那么可以将5个比特币的一个输出发送给商店所有者，并将一个15比特币的输出返回给自己作为找零（减去交易费用）。
                    - 找零地址不必与输入时提供的地址相同，出于隐私的原因，通常是所有者钱包中的新地址。
                    - 不同的钱包可以在汇总输入以进行用户请求的付款时使用不同的策略。它们可能会聚合许多小输入，或者使用等于或大于所需付款的输入。
                    - 总的来讲，交易是将钱从交易输入移至输出。输入是指比特币的来源，通常是之前一笔交易的输出。
                </section>

                <section data-markdown>
                    ## 常见的交易形式
                    - [最普通的交易](./images/commontx.png)
                    - [打包资金的交易](./images/aggrtx.png)
                    - [分散资金的交易](./images/distx.png)
                </section>

                <section data-markdown>
                    ## 交易的构建
                    - Alice的钱包应用知道如何选取合适的输入和输出以建立Alice所希望的交易。
                    - Alice只需要指定目标地址和金额，其余的细节钱包应用会在后台自动完成。
                    - 钱包应用可以在完全离线时建立交易。
                    - 就像在家里写张支票， 之后放到信封发给银行一样。
                    - 比特币交易建立和签名时不用连接比特币网络。
                    - 只有在执行交易时才需要将交易发送到网络。
                </section>

                <section data-markdown>
                    ## 获取正确的输入
                    - Alice的钱包应用首先要找到一些足够支付给Bob所需金额的输入。
                    - 钱包应用跟踪着钱包中某个地址的所有可用输出。
                    - 完整客户端含有整个区块链中所有交易的所有未消费输出副本。
                    - 完整客户端占太大的硬盘空间，所以大多数钱包使用轻量级的客户端，只保存用户自己的未消费输出。
                </section>

                <section data-markdown>
                    ## 查找Alice的比特币地址所有的未消费的输出
                    ```sh
                    $ curl https://blockchain.info/unspent?active=1Cdid9KFAaatwczBwBttQcwXYCpvK8h7FK
                    {
                    
                        "unspent_outputs":[
                    
                            {
                                "tx_hash":"186f9f998a5...2836dd734d2804fe65fa35779",
                                "tx_index":104810202,
                                "tx_output_n": 0,
                                "script":"76a9147f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a888ac",
                                "value": 10000000,
                                "value_hex": "00989680",
                                "confirmations":0
                            }
                            ... 
                        ]
                    }
                    ```
                </section>

                <section data-markdown>
                    [点击这里 查看Joe和Alice间的交易信息](http://bit.ly/1tAeeGr)
                </section>

                <section data-markdown>
                    ## 创建交易输出
                    - 交易的输出会被创建成为一个包含这笔数额的脚本的形式，只能被引入这个脚本的一个解答后才能兑换。
                    - 简单点说就是，Alice的交易输出会包含一个脚本，这个脚本说“这个输出谁能拿出一个签名和Bob的公开地址匹配上，就支付给谁”。
                    - 因为只有Bob的钱包的私钥可以匹配这个地址，所以只有Bob的钱包可以提供这个签名以兑换这笔输出。
                    - 因此Alice包装的输出需要Bob的签名来解锁。
                </section>

                <section data-markdown>
                    ## 创建交易输出
                    - 交易还会包含第二个输出
                    - Alice的金额是0.10比特币的输出。
                    - 0.015比特币一杯咖啡。
                    - 需要找Alice 0.085比特币的零钱。
                    - Alice钱包创建给她的找零输出就在付给Bob的同一个交易里面。
                    - Alice的钱包将她的金额分成了两个支付：一个给Bob，一个给自己。
                </section>

                <section data-markdown>
                    ## 创建交易输出
                    - 为了让这笔交易尽快地被网络处理，Alice的钱包会多付一小笔费用。
                    - 这个不是明显地包含在交易中的；而是通过输入和输出的差值所隐含的。
                    - 如果Alice创建找零时只找0.0845比特币，而不是0.085比特币的话，这里就有剩下0.0005比特币（50万聪）。
                    - 因为加起来小于0.10，所以0.10比特币的输入就没有被完整的消费。这个差值会被矿工当作交易费放到区块的交易里，最终放进区块链。
                    - [点击查看交易](http://bit.ly/1u0FIGs)
                </section>

                <section data-markdown>
                    ## 交易上链
                    - 这个被Alice钱包应用创建的交易大小为258字节。
                    - 包含了确认资金所有权和分配给新所有者所需要的全部信息。
                    - 现在，这笔交易必须要被传播到比特币网络中以成为分布式账簿（区块链）的一部分。
                </section>

                <section data-markdown>
                    ## 如何传播
                    - 交易迅速地从P2P网络中传播开来，几秒内就能到达大多数节点。
                </section>

                <section data-markdown>
                    ## 误解
                    - 一个对比特币交易的常见误解是它们必须要等10分钟后被确认加进一个新区块，或等60分钟以得到六次确认后才是有效的。
                    - 虽然这些确认可以确保交易已被整个网络接受，但对于像一杯咖啡这样的小额商品来说就没有必要等待那么长时间了。
                    - 一个商家可以免确认来接受比特币小额支付。
                    - 这样做的风险不比接受一个不是用有效身份证领取或没有签名的信用卡的风险更大，而后者是现在商家常做的事情。
                </section>

                <section data-markdown>
                    ## 比特币挖矿
                    - 交易在比特币网络上传播开来。但只有被一个称为挖矿的过程验证且加到一个区块中之后，交易才会成为区块链的一部分。
                    - 比特币系统的信任是建立在计算的基础上的。交易被打包在一起放进区块中时需要极大的计算量来证明，但只需少量计算就能验证它们已被证明。
                </section>

                <section data-markdown>
                    ## 挖矿有两个重要作用
                    - 挖矿节点通过参考比特币的共识规则验证所有交易。因此，挖矿通过拒绝无效或畸形交易来提供比特币交易的安全性。
                    - 挖矿在构建区块时会创造新的比特币，和一个中央银行印发新的纸币很类似。每个区块创造的比特币数量是固定的，随时间会渐渐减少。
                </section>

                <section data-markdown>
                    ## 挖矿简述
                    - 挖矿在成本和报酬之间取得了良好的平衡。
                    - 挖矿采用电力来解决数学问题。
                    - 一个成功的矿工将以新的比特币和交易费的形式获取奖励。
                    - 但是，只有矿工正确验证了所有的交易，才能获得奖励，才能达到协商一致的规则。
                    - 这种微妙的平衡为没有中央权力机构的比特币提供安全保障。
                </section>

                <section data-markdown>
                    ## 以数独类比挖矿
                    - 一旦有人发现正解之后，数独游戏会自动调整难度以使游戏每次需要大约10分钟解决。
                    - 想象一个有几千行几千列的巨大数独游戏。如果给你一个已经完成的数独，你可以很快地验证它。 
                    - 然而，如果数独只有几个方格里有数字其余方格都为空的话，就会花费非常长的时间来解决。
                    - 数独游戏的困难度可以通过改变其大小（更多或更少行列）来调整，但即使它非常大时验证它也是相当容易的。
                    - 而比特币中的"谜题"是基于哈希加密算法的，其展现了相似的特性：非对称地，它解起来困难而验证很容易，并且它的困难度可以调整。
                </section>

                <section data-markdown>
                    ## 工作量证明算法
                    - 用SHA256加密算法不断地对区块头和一个随机数字进行哈希计算，直到出现一个和预设值相匹配的解。
                    - 第一个找到解的矿工会赢得这局竞赛并会将此区块发布到区块链中。
                    - 随着更多的矿工加入比特币网络中，寻找谜题正解的困难度迅速增大。
                    - 普通电脑 -> 高级显卡 -> ASIC
                    - 挖矿的收益刚够电费
                </section>

                <section data-markdown>
                    ## 区块中的挖矿交易记录
                    - 新交易不断地从用户钱包和应用流入比特币网络。
                    - 当比特币网络上的节点看到这些交易时，会先将它们放到各自节点维护的一个临时的未经验证的交易池中(内存池)。
                    - 当矿工构建一个新区块时，会将交易从交易池中拿出来放到新区块中，然后通过尝试解决一个非常困难的问题（也叫工作量证明）以证明新区块的合法性。
                </section>

                <section data-markdown>
                    ## 挖矿的规则
                    - 交易被加进新区块时，以交易费用高的优先或者其它的一些规则进行排序。(交易很多时，交易费用高的先上链)
                    - 矿工一旦从网络上收到一个新区块时，会意识到在这个区块上的解题竞赛已经输掉了，会马上开始下一个新区块的挖掘工作。
                    - 它会立刻将一些交易和这个新区块的数字指纹放在一起开始构建下一个新区块，并开始给它计算工作量证明。
                    - 每个矿工会在他的区块中包含一个特殊的交易，将新生成的比特币（当前每区块为12.5比特币）作为报酬支付到他自己的比特币地址，再加上块中所有交易的交易费用的总和作为自己的报酬。
                    - 如果他找到了使得新区块有效的解法，他就会得到这笔报酬，因为这个新区块被加入到了总区块链中，他添加的这笔报酬交易也会变成可消费的。
                </section>

                <section data-markdown>
                    (点击查看包含Alice交易记录的区块信息)[https://blockchain.info/block-height/277316]
                </section>

                <section data-markdown>
                    ## 区块
                    - 当区块一个个堆上来时，这个交易变得指数级地越来越难被推翻，因此它在网络中得到更多信任。
                    - 我们可以看到包含Alice的交易的第277,316号区块。在它之下有277,316个区块（包括0号区块），像链子一样一个连着一个（区块链），一直连到0号区块，即创世区块。
                    - 随着时间变长，这个区块链的高度也随之增长，每个区块和整个链的计算复杂度也随之增加。
                    - 包含Alice的交易的区块后面形成的新区块使得信任度进一步增加，因为他们叠加了更多的计算在这个越来越长的链子上。
                    - 按惯例来说，一个区块获得六次以上“确认”时就被认为是不可撤销的了，因为要撤销和重建六个区块需要巨量的计算。
                </section>

                <section data-markdown>
                    (区块链示意图)[./images/blockchain.png]
                </section>

                <section data-markdown>
                    ## 消费这笔交易
                    - Alice的这笔交易已经成为区块的一部分被嵌入到了区块链中，它就成为了整个分布式比特币账簿的一部分并对所有比特币客户端应用可见。
                    - 每个比特币客户端都能独立地验证这笔交易是有效且可消费的。
                    - 全节点客户端可以追溯钱款的来源，从第一次有比特币在区块里生成的那一刻开始，按交易与交易间的关系顺藤摸瓜，直到所有的交易地址。
                    - 轻量级客户端通过确认一个交易在区块链中且在它后面有几个新区块来确认一个支付的合法性。这种方式叫做简易支付验证（SPV）。
                    - (示意图)[./images/tx3.png]
                </section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/search/search.js', async: true },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
