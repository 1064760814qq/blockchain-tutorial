<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>reveal.js – The HTML Presentation Framework</title>

		<meta name="description" content="A framework for easily creating beautiful presentations using HTML">
		<meta name="author" content="Hakim El Hattab">

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css" id="theme">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>第六章 交易</h1>
                </section>
                
                <section data-markdown>
                    ## 简介
                    - 比特币交易是比特币系统中最重要的部分。
                    - 根据比特币系统的设计原理，系统中任何其他的部分都是为了确保比特币交易可以被生成、能在比特币网络中得以传播和通过验证，并最终添加入全球比特币交易总账簿（比特币区块链）。
                    - 比特币交易的本质是数据结构，这些数据结构中含有比特币交易参与者价值转移的相关信息。
                    - 比特币区块链是一本全球复式记账总账簿，每个比特币交易都是在比特币区块链上的一个公开记录。
                </section>

                <section data-markdown>
                    ## 交易细节
                    [示意图](./images/jiaoyixijie.png)
                </section>

                <section data-markdown>
                    ## 交易 - 幕后细节
                    - 在幕后，实际的交易看起来与典型的区块浏览器提供的交易非常不同。
                    - 事实上，我们在各种比特币应用程序用户界面中看到的大多数高级结构实际上并不存在于比特币系统中。
                    - 我们可以使用Bitcoin Core的命令行界面（getrawtransaction和decodeawtransaction）来检索上面图中那笔“原始”交易，对其进行解码，并查看它包含的内容。 
                    - 交易被解码后是这个样子：
                </section>

                <section data-markdown>
                    ## 交易解码以后
                    ```
                    {
                        "version": 1,
                        "locktime": 0,
                        "vin": [
                          {
                            "txid":"7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18",
                            "vout": 0,
                            "scriptSig": "3045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813[ALL] 0484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade8416ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc17b4a10fa336a8d752adf",
                            "sequence": 4294967295
                          }
                       ],
                        "vout": [
                          {
                            "value": 0.01500000,
                            "scriptPubKey": "OP_DUP OP_HASH160 ab68025513c3dbd2f7b92a94e0581f5d50f654e7 OP_EQUALVERIFY OP_CHECKSIG"
                          },
                          {
                            "value": 0.08450000,
                            "scriptPubKey": "OP_DUP OP_HASH160 7f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a8 OP_EQUALVERIFY OP_CHECKSIG",
                          }
                        ]
                      }
                      ```
                </section>

                <section data-markdown>
                    ## 继续
                    - 您可能会注意到这笔交易似乎少了些什么东西，比如：发送者的地址在哪里？接收者的地址在哪里？
                    - 发送者发送的“0.1”个币的输入在哪里？
                    - 在比特币里，没有具体的货币，没有发送者，没有接收者，没有余额，没有帐户，没有地址。
                    - 为了使用者的便利，以及使事情更容易理解，所有这些都构建在更高层次上。你可能还会注意到很多奇怪和难以辨认的字段以及十六进制字符串。
                </section>

                <section data-markdown>
                    ## 交易的输入输出
                    - 比特币交易中的基础构建单元是交易输出。
                    - 交易输出是比特币不可分割的基本组合，记录在区块上，并被整个网络识别为有效。
                    - 比特币完整节点跟踪所有可找到的和可使用的输出，称为“未花费的交易输出”（unspent transaction outputs），即UTXO。
                    - 所有UTXO的集合被称为UTXO集，目前有数百万个UTXO。
                    - 当新的UTXO被创建，UTXO集就会变大，当UTXO被消耗时，UTXO集会随着缩小。每一个交易都代表UTXO集的变化（状态转换）。
                </section>

                <section data-markdown>
                    ## 继续
                    - 当我们说用户的钱包已经“收到”比特币时，我们的意思是，钱包已经检测到了可用的UTXO。
                    - 通过钱包所控制的密钥，我们可以把这些UTXO花出去。
                    - 因此，用户的比特币“余额”是指用户钱包中可用的UTXO总和，而他们可能分散在数百个交易和区块中。
                </section>

                <section data-markdown>
                    ## 继续
                    - “一个用户的比特币余额”，这个概念是比特币钱包应用创建的派生之物。
                    - 比特币钱包通过扫描区块链并聚集所有属于该用户的UTXO来计算该用户的余额。
                    - 大多数钱包维护一个数据库或使用数据库服务来存储所有UTXO的快速参考集，这些UTXO由用户所有的密钥来控制花费行为。
                </section>

                <section data-markdown>
                    ## 继续
                    - 一个UTXO可以是1“聪”（satoshi）的任意倍数（整数倍）。
                    - 就像美元可以被分割成表示两位小数的“分”一样，比特币可以被分割成八位小数的“聪”。
                    - 尽管UTXO可以是任意值，但一旦被创造出来，即不可分割。
                    - 这是UTXO值得被强调的一个重要特性：UTXO是面值为“聪”的离散（不连续）且不可分割的价值单元，一个UTXO只能在一次交易中作为一个整体被消耗。
                </section>

                <section data-markdown>
                    ## 继续
                    - 如果一个UTXO比一笔交易所需量大，它仍会被当作一个整体而消耗掉，但同时会在交易中生成零头。
                    - 例如，你有一个价值20比特币的UTXO并且想支付1比特币，那么你的交易必须消耗掉整个20比特币的UTXO，并产生两个输出：一个支付了1比特币给接收人，另一个支付了19比特币的找零到你的钱包。
                    - 这样的话，由于UTXO（或交易输出）的不可分割特性，大部分比特币交易都会产生找零。
                </section>

                <section data-markdown>
                    ## 继续
                    - 想象一下，一位顾客要买1.5元的饮料。
                    - 她掏出钱包并试图从所有硬币和钞票中找出一种组合来凑齐她要支付的1.5元。
                    - 如果可能的话，她会选刚刚好的零钱（比如一张1元纸币和5个一毛硬币）或者是小面额的组合（比如3个五毛硬币）。
                    - 如果都不行的话，她会用一张大面额的钞票，比如5元纸币。如果她把5元给了商店老板，她会得到3.5元的找零，并把找零放回她的钱包以供未来的交易使用。
                </section>

                <section data-markdown>
                    ## 继续
                    - 类似的，一笔比特币交易可以是任意金额，但必须从用户可用的UTXO中创建出来。
                    - 用户不能再把UTXO进一步细分，就像不能把一元纸币撕开而继续当货币使用一样。
                    - 用户的钱包应用通常会从用户可用的UTXO中选取多个来拼凑出一个大于或等于一笔交易所需的比特币量。
                </section>

                <section data-markdown>
                    ## 继续
                    - 就像现实生活中一样，比特币应用可以使用一些策略来满足付款需求：
                    - 组合若干小额UTXO，并算出准确的找零；或者使用一个比交易额大的UTXO然后进行找零。
                    - 所有这些复杂的、由可花费UTXO组成的集合，都是由用户的钱包自动完成，并不为用户所见。
                    - 只有当你以编程方式用UTXO来构建原始交易时，这些才与你有关。
                </section>

                <section data-markdown>
                    ## 继续
                    - 一笔交易会消耗先前的已被记录（存在）的UTXO，并创建新的UTXO以备未来的交易消耗。
                    - 通过这种方式，一定数量的比特币价值在不同所有者之间转移，并在交易链中消耗和创建UTXO。
                    - 一笔比特币交易通过使用所有者的签名来解锁UTXO，并通过使用新的所有者的比特币地址来锁定并创建UTXO。
                </section>

                <section data-markdown>
                    ## 继续
                    - 从交易的输出与输入链角度来看，有一个例外，即存在一种被称为“币基交易”（Coinbase Transaction）的特殊交易，
                    - 它是每个区块中的第一笔交易，这种交易存在的原因是作为对挖矿的奖励，创造出全新的可花费比特币用来支付给“赢家”矿工。
                    - 这也就是为什么比特币可以在挖矿过程中被创造出来，我们将在“挖矿”这一章进行详述。
                </section>

                <section data-markdown>
                    ## 继续
                    - 输入和输出，哪一个是先产生的呢？先有鸡还是先有蛋呢？
                    - 严格来讲，先产生输出，因为可以创造新比特币的“币基交易”没有输入，但它可以无中生有地产生输出。
                </section>
			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/search/search.js', async: true },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
